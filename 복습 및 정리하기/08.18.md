# 작성 날짜: 2018.08.18
# 오늘의 목표
1. 이전 파일 pager 오류부분
2. IntersectionObserver
3. firebase의 storage에 사진 넣기
# 공부 내용
# 1. pager
+ 마지막 페이지로 가는 버튼 이상 작동
```js
function setPager(isEnd, totalRecord) {
    page = Number(page);
	var totalPage = Math.ceil(totalRecord/size[cate]); // 총 페이지수
	if(totalPage > 50) totalPage = 50;
	if(cate === 'vclip' && totalPage > 15) totalPage = 15;
	var pagerCnt = 5;			// pager에 보여질 페이지 수
	var startPage;				// pager의 시작 번호
	var endPage;					// pager의 마지막 번호
	startPage = Math.floor((page - 1) / pagerCnt) * pagerCnt + 1;
	endPage = startPage + pagerCnt - 1;
	if(endPage > totalPage) endPage = totalPage;
	$('.pager-wrap .bt-page').remove(); // el가 삭제되면 이벤트도 삭제된다.
	for(var i=startPage; i<=endPage; i++) {
		// $('.pager-wrap .bt-next').before('<a href="#" class="bt-page">'+i+'</a>');
		if(i === page) 
			$('<i class="bt-page active" data-page="'+i+'">'+i+'</i>').insertBefore('.pager-wrap .bt-next').click(onPagerClick);
		else
			$('<i class="bt-page" data-page="'+i+'">'+i+'</i>').insertBefore('.pager-wrap .bt-next').click(onPagerClick);
	}	
	$('.pager-wrap .bt-first')[0].dataset['page'] = 1;
	$('.pager-wrap .bt-pager-prev')[0].dataset['page'] = startPage === 1 ? 1 : startPage - 1;
	$('.pager-wrap .bt-prev')[0].dataset['page'] = page === 1 ? 1 : page - 1;
	$('.pager-wrap .bt-next')[0].dataset['page'] = page === totalPage ? totalPage : page + 1;
	$('.pager-wrap .bt-pager-next')[0].dataset['page'] = endPage === totalPage ? endPage : endPage + 1;
	$('.pager-wrap .bt-last')[0].dataset['page'] = totalPage;
}
```
+ totalPage에 오류 발생
+ setPager(isEnd, totalRecord) -->isEnd 제거 (불필요)
  + onSuccess에서 받은 `(v.meta.pageable_count)`인자를 `totalRecord`로 받았다.
  + totalRecord를 변수(totalPage)에 담음
  + 페이지가 넘어갈 때마다 `pageable_count`가 변하였다.` endPage`의 값이 더 큰 경우가 발생!
```js
if(endPage > totalPage) endPage = totalPage;    //추가 해결완료
```
+  문제 해결 인듯 했으나 이번엔 `('.bt-first')`를 클릭하면 `pager`의 숫자가 사라졌다.
+  다른 방법으로 if문을 돌렸다.
```js
if(page === 1){
	    $('.pager-wrap .bt-first').attr('disabled', true);
    else
        $('.pager-wrap .bt-first').attr('disabled', false);
    if(startPage === 1)
	    $('.pager-wrap .bt-pager-prev').attr('disabled', true);
    else
        $('.pager-wrap .bt-pager-prev').attr('disabled', false)[0].dataset['page'] = startPage - 1;
    if(page === 1)
        $('.pager-wrap .bt-prev').attr('disabled', true);
    else
	    $('.pager-wrap .bt-prev').attr('disabled', false)[0].dataset['page'] = page - 1;
    if(page === totalPage)
        $('.pager-wrap .bt-next').attr('disabled', true);
    else
        $('.pager-wrap .bt-next').attr('disabled', false)[0].dataset['page'] = page + 1;
    if(endPage === totalPage)
        $('.pager-wrap .bt-pager-next').attr('disabled', true);
    else
        $('.pager-wrap .bt-pager-next').attr('disabled', false)[0].dataset['page'] = endPage + 1;
    if(page === totalPage)
	    $('.pager-wrap .bt-last').attr('disabled', true);
    else
        $('.pager-wrap .bt-last').attr('disabled', false)[0].dataset['page'] = totalPage;
}
```

# 2.IntersectionObserver
+ 스크롤 시에, 더 많은 컨텐츠가 로드 및 렌더링되어 사용자가 페이지를 이동하지 않아도 되게 하는 infinite-scroll 을 구현
+ 구현 하기전 더미 생성 + 로딩 이미지 추가 `var observer` 전역변수로 설정
+ <strong>imageList, vclipList</strong>에 구현 해보자
## callback
```js
function onIntersection(el) {
	if(el[el.length - 1].isIntersecting && isEnd === false) {
		page = Number(page) + 1;
		axios.get(getPath(cate), getParams(query)).then(onSuccess).catch(onError);
	}
	if(isEnd == true) { //unobserve--> observe 제거!
        if(observer && $('.observer')[0]) observer.unobserve(($('observer')[0]));
        $('.observer').remove();
	}
}
```

```js
$('.lists').append('<div class="observer d-flex justify-content-center py-5"><i class="fa fa-spin fa-spinner fa-2x"></i></div>'); //awesome-font의 속성
```
+ `$('.lists')` 생성 후에 위의 코드 입력 후 
```js
observer = new IntersectionObserver(onIntersection, {threshold: 1});
    observer.observe(document.querySelector('.observer'));
    //call back 실행
```
+ observer 실행
+ 문제 : image에서 결과를 검색하고 vclip으로 재검색 하면 한 번에 모든 데이터가 1page에 나타났다.
+ `append` -->`after` 변경 
+ image와 vclip 각각 `$('observer').remove();`추가
```js
$('.lists').after('<div class="observer d-flex justify-content-center py-5"><i class="fa fa-spin fa-spinner fa-2x"></i></div>');
function setImageList() {
    $('observer').remove();
    // 나머지 이전 파일과 동일
}
function setVclipList() {
    $('observer').remove();
    // 나머지 동일
}
```
+ 추가된 `observer`를 삭제하고 재실행 하니 잘된다.
## 옵션을 더 알아보자
+ 3가지 속성을 가지고 있다.
1. `root` 
2. `marginRoot` 
3. `threshold` 
## 1. `root`
+ 기본값은 `Browser ViewPort` \ 타겟의 노출, 비노출의 여부를 결정한다.
+ 타겟이 없다면 노출되어도 비노출로 표현함.
+ 존재 한다면 callback 함수 실행!
## 2. `marginRoot` 
+ `'0px, 0px, 0px, 0px'`로 정의 margin값을 포함하고 나타난다.`(문자열)`
## 3. `threshold`
+ 숫자나 배열로 나타낼 수 있다.
+ 숫자로 값을 주면 그 값에서 callback
+ 배열로 준다면 각각 값마다 callback
## IE11에선 적용 불가..
+ IE11에서는 적용이 되지 않는다..(IE11은 여러가지가 안된다.. 그래도 내년엔 종료하니!)
```js
//polyfill 파일을 적용해준다
<script src="../js/promise.polyfill.min.js"></script>   
//axios가 promise를 사용한다고함
<script src="../js/intersection-observer.js"></script>
```
# 3.firebase의 storage에 사진넣기
# Review